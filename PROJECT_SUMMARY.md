# Полный обзор проекта: Система управления заявками "КаналТехСервис"

## Описание проекта

Это полноценное веб-приложение, сочетающее в себе Telegram-бота и веб-админку для управления заявками на ассенизаторские услуги в г. Ярцево. Проект позволяет клиентам подавать заявки через Telegram-бота, а администраторам - управлять этими заявками через веб-интерфейс.

## Архитектура проекта

```
├── main.py                           # Основной файл приложения (Telegram-бот + Flask-админка)
├── requirements.txt                  # Зависимости Python
├── create_admin_password.py         # Утилита для генерации хеша пароля администратора
├── .env                             # Файл конфигурации (не включен в Git, см. .gitignore)
├── .gitignore                       # Правила игнорирования файлов для Git
├── Procfile                         # Файл конфигурации для Heroku/BotHost
├── templates/                       # Папка с HTML-шаблонами
│   ├── login.html                   # Страница входа в админку
│   └── dashboard.html               # Главная страница админки
├── database_schema.md               # Документация по структуре БД
├── README.md                        # Основная документация
├── DEPLOYMENT_GUIDE.md             # Инструкция по развертыванию
├── services.html                    # Страница с описанием услуг
└── requests.db                      # База данных SQLite (генерируется при первом запуске)
```

## Функциональность

### Telegram-бот
- Подача заявок на ассенизаторские услуги
- FSM-машина для сбора данных:
  - ФИО клиента
  - Адрес выполнения работ
  - Тип услуги
  - Контактный телефон
- Защита от спама: не более 1 заявки в 24 часа от одного пользователя
- Команда `/status` для проверки статуса последней заявки
- Отправка уведомлений о смене статуса заявки

### Веб-админка
- Авторизация с использованием логина/пароля
- Просмотр всех заявок в табличном виде
- Изменение статуса заявки (Новая, В работе, Выполнена, Отменена)
- Добавление комментариев к заявкам
- Экспорт всех заявок в CSV-файл
- Пагинация заявок
- Отправка уведомлений пользователям о смене статуса заявки

## Технологии

- **Python 3.x**
- **aiogram 3.x** - для Telegram-бота
- **Flask** - для веб-админки
- **Flask-Login** - для аутентификации
- **SQLite** - для хранения данных
- **Bootstrap 5** - для оформления веб-интерфейса
- **pandas** - для экспорта в CSV
- **python-dotenv** - для работы с переменными окружения

## Зависимости (requirements.txt)

```
aiogram==3.4.1
Flask==2.3.3
Flask-Login==0.6.3
Werkzeug==2.3.7
python-dotenv==1.0.0
pandas==2.0.3
openpyxl==3.1.2
aiohttp==3.8.5
```

## Переменные окружения (.env)

```
BOT_TOKEN=ваш_токен_бота
SECRET_KEY=любой_секретный_ключ
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=сгенерированный_хеш_пароля
```

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка конфигурации
1. Скопируйте `.env.example` в `.env`:
```bash
cp .env.example .env
```

2. Замените `YOUR_BOT_TOKEN_HERE` на реальный токен вашего Telegram-бота

3. Сгенерируйте хеш пароля администратора:
```bash
python create_admin_password.py your_admin_password
```
Скопируйте полученный хеш и замените значение `ADMIN_PASSWORD_HASH` в файле `.env`

### 3. Запуск приложения
```bash
python main.py
```

Приложение запускает одновременно:
- Telegram-бота (в фоне)
- Веб-админку (на порту 5000 или переменной PORT из окружения)

## Структура базы данных

Таблица `requests` содержит следующие поля:
- id (INTEGER PRIMARY KEY AUTOINCREMENT)
- user_id (INTEGER NOT NULL) - ID пользователя в Telegram
- full_name (TEXT NOT NULL) - ФИО клиента
- address (TEXT NOT NULL) - Адрес выполнения работ
- service_type (TEXT NOT NULL) - Тип услуги
- phone (TEXT NOT NULL) - Контактный телефон
- status (TEXT DEFAULT 'Новая') - Статус заявки
- comment (TEXT) - Комментарий
- created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP) - Дата создания

## Безопасность

- Пароли администратора хранятся в виде хешей
- Использование переменных окружения для конфиденциальных данных
- Защита от повторных заявок через проверку по времени
- Защита маршрутов Flask с помощью декоратора @login_required

## Развертывание на BotHost.ru

1. Зарегистрируйтесь на [BotHost.ru](https://bothost.ru)
2. Создайте новый проект Python
3. Загрузите все файлы из этого репозитория
4. В настройках проекта укажите точку входа: `main.py`
5. Установите переменные окружения в интерфейсе BotHost.ru

## Лицензия

Проект может использоваться свободно для некоммерческих и коммерческих целей.