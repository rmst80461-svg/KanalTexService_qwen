# Система управления заявками "КаналТехСервис"

## Описание
Система управления заявками для компании "КаналТехСервис", оказывающей ассенизаторские услуги в г. Ярцево.
Система включает в себя:
- Telegram-бота для подачи заявок
- Веб-админку для управления заявками

## Архитектура
```
├── database/
│   └── database.py          # Модуль работы с базой данных
├── bot/
│   ├── main.py              # Основной модуль Telegram-бота
│   └── keyboards.py         # Модуль клавиатур бота
├── web/
│   ├── app.py               # Основной модуль веб-админки
│   ├── notifications.py     # Модуль отправки уведомлений
│   └── templates/           # Шаблоны HTML
│       ├── login.html       # Страница входа
│       └── dashboard.html   # Главная страница админки
├── .env                     # Файл конфигурации
├── requirements.txt         # Зависимости
└── create_admin_password.py # Утилита для генерации хеша пароля
```

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка конфигурации
1. Скопируйте `.env.example` в `.env`:
```bash
cp .env.example .env
```

2. Замените `YOUR_BOT_TOKEN_HERE` на реальный токен вашего Telegram-бота

3. Сгенерируйте хеш пароля администратора:
```bash
python create_admin_password.py your_admin_password
```
Скопируйте полученный хеш и замените значение `ADMIN_PASSWORD_HASH` в файле `.env`

### 3. Запуск приложения

#### Запуск Telegram-бота:
```bash
python bot/main.py
```

#### Запуск веб-админки:
```bash
python web/app.py
```
Админка будет доступна по адресу http://localhost:5000

## Функциональность

### Telegram-бот
- Подача заявок на ассенизаторские услуги
- FSM-машина для сбора данных:
  - ФИО клиента
  - Адрес выполнения работ
  - Тип услуги
  - Контактный телефон
- Защита от спама: не более 1 заявки в 24 часа от одного пользователя
- Команда `/status` для проверки статуса последней заявки

### Веб-админка
- Авторизация с использованием логина/пароля
- Просмотр всех заявок в табличном виде
- Изменение статуса заявки (Новая, В работе, Выполнена, Отменена)
- Добавление комментариев к заявкам
- Экспорт всех заявок в CSV-файл
- Отправка уведомлений пользователям о смене статуса заявки

## Технологии
- **Python 3.x**
- **aiogram 3.x** - для Telegram-бота
- **Flask** - для веб-админки
- **SQLite** - для хранения данных
- **Bootstrap 5** - для оформления веб-интерфейса
- **pandas** - для экспорта в CSV

## Безопасность
- Пароли администратора хранятся в виде хешей
- Использование переменных окружения для конфиденциальных данных
- Защита от повторных заявок через проверку по времени