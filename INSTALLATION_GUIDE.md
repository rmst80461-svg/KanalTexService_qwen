# Инструкция по установке и запуску проекта "КаналТехСервис"

## Описание
Полнофункциональное веб-приложение, сочетающее Telegram-бота и веб-админку для управления заявками на ассенизаторские услуги в г. Ярцево.

## Структура проекта
```
├── main.py                           # Основной файл приложения (Telegram-бот + Flask-админка)
├── requirements.txt                  # Зависимости Python
├── create_admin_password.py         # Утилита для генерации хеша пароля администратора
├── .gitignore                       # Правила игнорирования файлов для Git
├── Procfile                         # Файл конфигурации для Heroku/BotHost
├── templates/                       # Папка с HTML-шаблонами
│   ├── login.html                   # Страница входа в админку
│   └── dashboard.html               # Главная страница админки
├── database_schema.md               # Документация по структуре БД
├── README.md                        # Основная документация
├── DEPLOYMENT_GUIDE.md             # Инструкция по развертыванию
└── services.html                    # Страница с описанием услуг
```

## Установка

### 1. Клонирование репозитория
```bash
git clone <url_репозитория>
cd <название_папки_репозитория>
```

### 2. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 3. Настройка конфигурации
1. Создайте файл `.env` на основе шаблона:
```bash
cp .env.example .env
```

2. Получите токен Telegram-бота у [@BotFather](https://t.me/BotFather)

3. Сгенерируйте хеш пароля администратора:
```bash
python create_admin_password.py your_admin_password
```

4. Откройте файл `.env` и замените значения:
   - `BOT_TOKEN`: ваш токен бота
   - `SECRET_KEY`: любой случайный секретный ключ
   - `ADMIN_USERNAME`: имя пользователя для админ-панели (по умолчанию: admin)
   - `ADMIN_PASSWORD_HASH`: сгенерированный хеш пароля

## Запуск

### Локальный запуск
```bash
python main.py
```

Приложение запускает одновременно:
- Telegram-бота (обрабатывает команды и заявки)
- Веб-админку (доступна по адресу http://localhost:5000)

### Запуск на сервере
Приложение автоматически использует переменную PORT из окружения, что позволяет разворачивать его на платформах вроде Heroku или BotHost.ru.

## Использование

### Telegram-бот
1. Найдите вашего бота в Telegram
2. Отправьте команду `/start`
3. Следуйте инструкциям бота для подачи заявки

### Веб-админка
1. Откройте в браузере адрес, где запущено приложение (например, http://localhost:5000)
2. Войдите с использованием логина и пароля, указанных в `.env`
3. Просматривайте и управляйте заявками через удобный интерфейс
4. Используйте кнопку "Экспорт CSV" для выгрузки всех заявок

## Функциональность

### Telegram-бот
- Подача заявок на ассенизаторские услуги
- FSM-машина для сбора данных:
  - ФИО клиента
  - Адрес выполнения работ
  - Тип услуги
  - Контактный телефон
- Защита от спама: не более 1 заявки в 24 часа от одного пользователя
- Команда `/status` для проверки статуса последней заявки
- Отправка уведомлений о смене статуса заявки

### Веб-админка
- Авторизация с использованием логина/пароля
- Просмотр всех заявок в табличном виде
- Изменение статуса заявки (Новая, В работе, Выполнена, Отменена)
- Добавление комментариев к заявкам
- Экспорт всех заявок в CSV-файл
- Пагинация заявок
- Отправка уведомлений пользователям о смене статуса заявки

## Развертывание на BotHost.ru

1. Зарегистрируйтесь на [BotHost.ru](https://bothost.ru)
2. Создайте новый проект Python
3. Загрузите все файлы из этого репозитория
4. В настройках проекта укажите точку входа: `main.py`
5. Установите переменные окружения в интерфейсе BotHost.ru:
   - `BOT_TOKEN`: токен вашего Telegram-бота
   - `SECRET_KEY`: секретный ключ для Flask
   - `ADMIN_USERNAME`: имя пользователя для админ-панели
   - `ADMIN_PASSWORD_HASH`: хеш пароля администратора

## Безопасность

- Пароли администратора хранятся в виде хешей
- Использование переменных окружения для конфиденциальных данных
- Защита от повторных заявок через проверку по времени
- Защита маршрутов Flask с помощью декоратора @login_required

## Техническая поддержка

Если у вас возникли проблемы с установкой или использованием приложения, обратитесь к файлу README.md или DEPLOYMENT_GUIDE.md для получения дополнительной информации.