"""–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–º."""
import json
import os

PRICES_FILE = os.path.join(os.path.dirname(__file__), '..', '..', 'data', 'prices.json')

PRICES_DATA = {}

def import_prices_data():
    """–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –∏–∑ JSON —Ñ–∞–π–ª–∞."""
    global PRICES_DATA
    if os.path.exists(PRICES_FILE):
        try:
            with open(PRICES_FILE, 'r', encoding='utf-8') as f:
                PRICES_DATA = json.load(f)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–Ω: {e}")
            PRICES_DATA = get_default_prices()
    else:
        PRICES_DATA = get_default_prices()
        save_prices_data()

def save_prices_data():
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–Ω –≤ JSON —Ñ–∞–π–ª."""
    os.makedirs(os.path.dirname(PRICES_FILE), exist_ok=True)
    with open(PRICES_FILE, 'w', encoding='utf-8') as f:
        json.dump(PRICES_DATA, f, ensure_ascii=False, indent=2)

def get_default_prices():
    """–î–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è –∞—Å—Å–µ–Ω–∏–∑–∞—Ç–æ—Ä—Å–∫–∏—Ö —É—Å–ª—É–≥."""
    return {
        "septic": {
            "title": "üöΩ –û—Ç–∫–∞—á–∫–∞ —Å–µ–ø—Ç–∏–∫–æ–≤ –∏ –≤—ã–≥—Ä–µ–±–Ω—ã—Ö —è–º",
            "items": [
                {"name": "–û—Ç–∫–∞—á–∫–∞ —Å–µ–ø—Ç–∏–∫–∞ –¥–æ 5 –º¬≥", "price": "–æ—Ç 3500"},
                {"name": "–û—Ç–∫–∞—á–∫–∞ —Å–µ–ø—Ç–∏–∫–∞ 5-10 –º¬≥", "price": "–æ—Ç 5000"},
                {"name": "–û—Ç–∫–∞—á–∫–∞ —Å–µ–ø—Ç–∏–∫–∞ 10-15 –º¬≥", "price": "–æ—Ç 7000"},
                {"name": "–í—ã–µ–∑–¥ –∑–∞ –ú–ö–ê–î (–∑–∞ –∫–º)", "price": "50"}
            ]
        },
        "cleaning": {
            "title": "üîß –ü—Ä–æ—á–∏—Å—Ç–∫–∞ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏",
            "items": [
                {"name": "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—á–∏—Å—Ç–∫–∞", "price": "–æ—Ç 2500"},
                {"name": "–ì–∏–¥—Ä–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—á–∏—Å—Ç–∫–∞", "price": "–æ—Ç 4000"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞—Å–æ—Ä–æ–≤", "price": "–æ—Ç 6000"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ —Ñ–µ–∫–∞–ª—å–Ω–æ–≥–æ –Ω–∞—Å–æ—Å–∞", "price": "–æ—Ç 3000"}
            ]
        },
        "blockage": {
            "title": "üíß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—Å–æ—Ä–æ–≤",
            "items": [
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ —Ä–∞–∫–æ–≤–∏–Ω—ã", "price": "–æ—Ç 1500"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ —É–Ω–∏—Ç–∞–∑–∞", "price": "–æ—Ç 2000"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ –≤–∞–Ω–Ω—ã", "price": "–æ—Ç 1800"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–æ—è–∫–∞", "price": "–æ—Ç 3500"}
            ]
        },
        "flushing": {
            "title": "üåä –ü—Ä–æ–º—ã–≤–∫–∞ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç—Ä—É–±",
            "items": [
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏", "price": "–æ—Ç 3000"},
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ –Ω–∞—Ä—É–∂–Ω–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏", "price": "–æ—Ç 5000"},
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ –ª–∏–≤–Ω–µ–≤–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏", "price": "–æ—Ç 4000"},
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ —Å –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏–µ–π", "price": "+1500"}
            ]
        },
        "service": {
            "title": "‚öôÔ∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å–µ–ø—Ç–∏–∫–æ–≤",
            "items": [
                {"name": "–ü–ª–∞–Ω–æ–≤–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ", "price": "–æ—Ç 5000"},
                {"name": "–ó–∞–º–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤", "price": "–æ—Ç 3000"},
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã", "price": "–æ—Ç 4000"},
                {"name": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∫—Ç–µ—Ä–∏–π", "price": "–æ—Ç 2000"}
            ]
        },
        "storm": {
            "title": "üåß –õ–∏–≤–Ω–µ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è",
            "items": [
                {"name": "–ß–∏—Å—Ç–∫–∞ –ª–∏–≤–Ω–µ–≤–æ–π –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏", "price": "–æ—Ç 4000"},
                {"name": "–ü—Ä–æ—á–∏—Å—Ç–∫–∞ –¥–æ–∂–¥–µ–ø—Ä–∏–µ–º–Ω–∏–∫–æ–≤", "price": "–æ—Ç 2500"},
                {"name": "–ü—Ä–æ–º—ã–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã", "price": "–æ—Ç 5000"},
                {"name": "–†–µ–º–æ–Ω—Ç –ª–∏–≤–Ω–µ–≤–∫–∏", "price": "–æ—Ç 6000"}
            ]
        },
        "video": {
            "title": "üìπ –í–∏–¥–µ–æ–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏",
            "items": [
                {"name": "–û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–æ 30 –º", "price": "–æ—Ç 5000"},
                {"name": "–û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ 30-50 –º", "price": "–æ—Ç 7000"},
                {"name": "–û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ 50 –º", "price": "–æ—Ç 10000"},
                {"name": "–í–∏–¥–µ–æ–æ—Ç—á–µ—Ç –Ω–∞ USB", "price": "+1000"}
            ]
        },
        "repair": {
            "title": "üî® –†–µ–º–æ–Ω—Ç –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º",
            "items": [
                {"name": "–ó–∞–º–µ–Ω–∞ —É—á–∞—Å—Ç–∫–∞ —Ç—Ä—É–±—ã", "price": "–æ—Ç 4000"},
                {"name": "–†–µ–º–æ–Ω—Ç —Å–µ–ø—Ç–∏–∫–∞", "price": "–æ—Ç 8000"},
                {"name": "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—á–µ–∫", "price": "–æ—Ç 3000"},
                {"name": "–ú–æ–Ω—Ç–∞–∂ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–∫–∞", "price": "–æ—Ç 5000"}
            ]
        }
    }

def format_prices_text(category: str) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —Ü–µ–Ω–∞–º–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    if category not in PRICES_DATA:
        return None
    
    data = PRICES_DATA[category]
    text = f"*{data['title']}*\n\n"
    
    for item in data['items']:
        text += f"‚Ä¢ {item['name']} ‚Äî *{item['price']} —Ä—É–±*\n"
    
    text += "\n_–¢–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞_"
    return text
